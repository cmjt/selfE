context("LGCP with INLA")

test_that("fit_lgcp_inla works", {
    library(spatstat)
    win <- spatstat::owin(c(0, 3), c(0, 3))
    npix <- 300
    spatstat.options(npixel = npix)
    beta0 <- 3
    sigma2x <- 0.2
    range <- 1.2
    nu <- 1
    set.seed(1)
    lg.s <- spatstat::rLGCP('matern', beta0, var = sigma2x,
                                scale = range / sqrt(8), nu = nu, win = win)
    xy <- cbind(lg.s$x, lg.s$y)
    loc.d <- 3 * cbind(c(0, 1, 1, 0, 0), c(0, 0, 1, 1, 0))
    mesh <- inla.mesh.2d(loc.domain = loc.d, offset = c(0.3, 1), 
                         max.edge = c(0.3, 0.7), cutoff = 0.05)
    sp <- stelfi:::owin_to_sp(win)
    fit <- stelfi::fit_lgcp_inla(mesh = mesh,
                         locs = xy, sp = sp)
    expect_equal(fit$summary.hyperpar[1,1], 2.105276, 0.001)
    expect_equal(fit$summary.fixed[1,1], 3.210938, 0.001)
})
